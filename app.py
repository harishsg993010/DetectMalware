import streamlit as st

hide_menu_style = """
        <style>
        #MainMenu {visibility: hidden;}
        </style>
        """
st.markdown(hide_menu_style, unsafe_allow_html=True)

def check_malicious():
    starts_cmd = st.checkbox("Starts CMD.EXE for commands execution")
    creates_files_user = st.checkbox("Creates files in the user directory")
    creates_files_program = st.checkbox("Creates files in the program directory")
    spawns_vssadmin = st.checkbox("Spawns vssadmin.exe")
    spawns_wmic = st.checkbox("Spawns wmic.exe")
    spawns_icacls =  st.checkbox("Spawns icacls.exe")
    spawns_dllhost = st.checkbox("Spawns dllhost.exe")
    spawns_rundll32 = st.checkbox("Spawns rundll32.exe")
    spawns_mshta = st.checkbox("Spawns mshta.exe")
    spawns_pwrshell = st.checkbox("Spawns powershell.exe")
    spawns_bcdedit = st.checkbox("Spawns bcdedit.exe")
    spawns_cscript = st.checkbox("Spawns cscsript.exe")
    spawns_msbuild = st.checkbox("Spawns msbuild.exe")

    registry_reads = st.multiselect("Select the registry reads",["HKEY_LOCAL_MACHINE\\SYSTEM\\CONTROLSET001\\CONTROL\\NLS\\SORTING\\VERSIONS","HKEY_LOCAL_MACHINE\\SYSTEM\\CONTROLSET001\\CONTROL\\COMPUTERNAME\\ACTIVECOMPUTERNAME","HKEY_LOCAL_MACHINE\\SOFTWARE\\MICROSOFT\\CRYPTOGRAPHY","HKEY_LOCAL_MACHINE\\SYSTEM\\CONTROLSET001\\CONTROL\\LSA\\FIPSALGORITHMPOLICY","HKEY_LOCAL_MACHINE\\SOFTWARE\\MICROSOFT\\WINDOWS NT\\CURRENTVERSION","HKEY_CURRENT_USER\\SOFTWARE\\MICROSOFT\\WINDOWS\\CURRENTVERSION\\INTERNET SETTINGS"])

    if any([starts_cmd, creates_files_user, creates_files_program, spawns_vssadmin, spawns_wmic, spawns_icacls,spawns_dllhost,spawns_rundll32,spawns_mshta,spawns_pwrshell,spawns_bcdedit,spawns_cscript,spawns_msbuild]) and any(
            ["HKEY_LOCAL_MACHINE\\SYSTEM\\CONTROLSET001\\CONTROL\\NLS\\SORTING\\VERSIONS" in registry_reads,
             "HKEY_LOCAL_MACHINE\\SYSTEM\\CONTROLSET001\\CONTROL\\COMPUTERNAME\\ACTIVECOMPUTERNAME" in registry_reads,
             "HKEY_LOCAL_MACHINE\\SOFTWARE\\MICROSOFT\\CRYPTOGRAPHY" in registry_reads,
             "HKEY_LOCAL_MACHINE\\SYSTEM\\CONTROLSET001\\CONTROL\\LSA\\FIPSALGORITHMPOLICY" in registry_reads,
             "HKEY_LOCAL_MACHINE\\SOFTWARE\\MICROSOFT\\WINDOWS NT\\CURRENTVERSION" in registry_reads]):
        st.warning("Process might be a Ransomeware")
    
    elif all(["HKEY_LOCAL_MACHINE\\SYSTEM\\CONTROLSET001\\CONTROL\\NLS\\SORTING\\VERSIONS" in registry_reads,
             "HKEY_LOCAL_MACHINE\\SYSTEM\\CONTROLSET001\\CONTROL\\COMPUTERNAME\\ACTIVECOMPUTERNAME" in registry_reads,
             "HKEY_LOCAL_MACHINE\\SOFTWARE\\MICROSOFT\\CRYPTOGRAPHY" in registry_reads,
             "HKEY_LOCAL_MACHINE\\SYSTEM\\CONTROLSET001\\CONTROL\\LSA\\FIPSALGORITHMPOLICY" in registry_reads,
             "HKEY_LOCAL_MACHINE\\SOFTWARE\\MICROSOFT\\WINDOWS NT\\CURRENTVERSION" in registry_reads,
             "HKEY_CURRENT_USER\\SOFTWARE\\MICROSOFT\\WINDOWS\\CURRENTVERSION\\INTERNET SETTINGS" in registry_reads]):
        st.warning("Process might be cobalt strike")

    else:
        st.success("Process is not known to be malicious")

st.title("Malicious Process Detector using behaviour")

st.markdown('This app helps you identify the type of malicious process')

st.markdown('Note : This tool shows output with few false positive malware classification')
check_malicious()
